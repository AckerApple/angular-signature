!function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(1),h=i(a),r=function(){function t(e,n,i,s){o(this,t),this.as?Object.assign(this,this.as):this.as=this,this.$window=e,this.$timeout=n,this.$element=i,i[0].style.display="block",i[0].style.width="100%",i[0].style.height="100%",this.$scope=s,this.canvas=i[0].getElementsByTagName("canvas")[0]}return s(t,[{key:"$onInit",value:function(){var t=this;this.signaturePad=new h.default(this.canvas),this.dataurl&&this.signaturePad.fromDataURL(this.dataurl),this.onResize(),this.$timeout(500).then(function(){return t.onResize()}),this.resizer=function(){return t.onResize()},this.$window.addEventListener("resize",this.resizer),this.touchstarter=function(){return t.onTouchstart()},this.touchender=function(){return t.onTouchend()},this.$element.bind("touchstart",this.touchstarter),this.$element.bind("touchend",this.touchender)}},{key:"$onChanges",value:function(t){t.dataurl&&t.dataurl.currentValue!=t.dataurl.previousValue&&this.signaturePad.fromDataURL(t.dataurl.currentValue)}},{key:"$onDestory",value:function(){this.$window.removeEventListener("resize",this.resizer),this.$element.unbind("touchstart",this.touchstarter),this.$element.unbind("touchend",this.touchender)}},{key:"onTouchstart",value:function(){var t=this;this.$scope.$digest(function(){t.updateModel()})}},{key:"onTouchend",value:function(){var t=this;this.$scope.$digest(function(){t.updateModel(),t.updateModel()})}},{key:"onMouseup",value:function(){this.updateModel()}},{key:"updateModel",value:function(){var t=this;this.$timeout().then(function(){var e=t.applyModel();t.dataurl=e.isEmpty?null:e.dataurl})}},{key:"clear",value:function(){this.signaturePad.clear(),this.applyModel()}},{key:"onResize",value:function(){var t=Math.max(this.$window.devicePixelRatio||1,1);this.canvas.style.display="none";var e=this.width||this.$element[0].offsetWidth,n=this.height||this.$element[0].offsetHeight;this.canvas.style.display=null,this.canvas.style.width=e+"px",this.canvas.style.height=n+"px",this.canvas.width=e*t,this.canvas.height=n*t,this.canvas.getContext("2d").scale(t,t),this.dataurl&&this.signaturePad.fromDataURL(this.dataurl)}},{key:"applyModel",value:function(){return this.model=this.model||{},this.signaturePad.isEmpty()?(this.model.dataurl=null,this.model.isEmpty=!0):(this.model.dataurl=this.signaturePad.toDataURL(),this.model.isEmpty=!1),this.dataurl=this.model.dataurl,this.onModel({model:this.model}),this.model}}]),t}();r.$inject=["$window","$timeout","$element","$scope"],e.default=angular.module("angular-signature",[]).component("signaturePad",{bindings:{as:"=?",model:"=?",dataurl:"=?",height:"@",width:"@",onModel:"&"},controller:r,template:'<canvas ng-mouseup="$ctrl.onMouseup()" ng-mousedown="$ctrl.updateModel()"></canvas>'}).name},function(t,e,n){var i,o;"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n,s){i=[],o=function(){return n.SignaturePad=s()}.apply(e,i),!(void 0!==o&&(t.exports=o))}(void 0,function(){/*!
	  * Signature Pad v1.5.3 | https://github.com/szimek/signature_pad
	  * (c) 2016 Szymon Nowak | Released under the MIT license
	  */
var t=function(t){"use strict";var e=function(t,e){var n=this,i=e||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this.onEnd=i.onEnd,this.onBegin=i.onBegin,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(n._mouseButtonDown=!0,n._strokeBegin(t))},this._handleMouseMove=function(t){n._mouseButtonDown&&n._strokeUpdate(t)},this._handleMouseUp=function(t){1===t.which&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(t))},this._handleTouchStart=function(t){if(1==t.targetTouches.length){var e=t.changedTouches[0];n._strokeBegin(e)}},this._handleTouchMove=function(t){t.preventDefault();var e=t.targetTouches[0];n._strokeUpdate(e)},this._handleTouchEnd=function(t){var e=t.target===n._canvas;e&&(t.preventDefault(),n._strokeEnd(t))},this._handleMouseEvents(),this._handleTouchEvents()};e.prototype.clear=function(){var t=this._ctx,e=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._reset()},e.prototype.toDataURL=function(){var t=this._canvas;return t.toDataURL.apply(t,arguments)},e.prototype.fromDataURL=function(t){var e=this,n=new Image,i=window.devicePixelRatio||1,o=this._canvas.width/i,s=this._canvas.height/i;this._reset(),n.src=t,n.onload=function(){e._ctx.drawImage(n,0,0,o,s)},this._isEmpty=!1},e.prototype._strokeUpdate=function(t){var e=this._createPoint(t);this._addPoint(e)},e.prototype._strokeBegin=function(t){this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},e.prototype._strokeDraw=function(t){var e=this._ctx,n="function"==typeof this.dotSize?this.dotSize():this.dotSize;e.beginPath(),this._drawPoint(t.x,t.y,n),e.closePath(),e.fill()},e.prototype._strokeEnd=function(t){var e=this.points.length>2,n=this.points[0];!e&&n&&this._strokeDraw(n),"function"==typeof this.onEnd&&this.onEnd(t)},e.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),t.addEventListener("mouseup",this._handleMouseUp)},e.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},e.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},e.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),t.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},e.prototype.isEmpty=function(){return this._isEmpty},e.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},e.prototype._createPoint=function(t){var e=this._canvas.getBoundingClientRect();return new n(t.clientX-e.left,t.clientY-e.top)},e.prototype._addPoint=function(t){var e,n,o,s,a=this.points;a.push(t),a.length>2&&(3===a.length&&a.unshift(a[0]),s=this._calculateCurveControlPoints(a[0],a[1],a[2]),e=s.c2,s=this._calculateCurveControlPoints(a[1],a[2],a[3]),n=s.c1,o=new i(a[1],e,n,a[2]),this._addCurve(o),a.shift())},e.prototype._calculateCurveControlPoints=function(t,e,i){var o=t.x-e.x,s=t.y-e.y,a=e.x-i.x,h=e.y-i.y,r={x:(t.x+e.x)/2,y:(t.y+e.y)/2},u={x:(e.x+i.x)/2,y:(e.y+i.y)/2},c=Math.sqrt(o*o+s*s),l=Math.sqrt(a*a+h*h),d=r.x-u.x,p=r.y-u.y,v=l/(c+l),y={x:u.x+d*v,y:u.y+p*v},f=e.x-y.x,_=e.y-y.y;return{c1:new n(r.x+f,r.y+_),c2:new n(u.x+f,u.y+_)}},e.prototype._addCurve=function(t){var e,n,i=t.startPoint,o=t.endPoint;e=o.velocityFrom(i),e=this.velocityFilterWeight*e+(1-this.velocityFilterWeight)*this._lastVelocity,n=this._strokeWidth(e),this._drawCurve(t,this._lastWidth,n),this._lastVelocity=e,this._lastWidth=n},e.prototype._drawPoint=function(t,e,n){var i=this._ctx;i.moveTo(t,e),i.arc(t,e,n,0,2*Math.PI,!1),this._isEmpty=!1},e.prototype._drawCurve=function(t,e,n){var i,o,s,a,h,r,u,c,l,d,p,v=this._ctx,y=n-e;for(i=Math.floor(t.length()),v.beginPath(),s=0;i>s;s++)a=s/i,h=a*a,r=h*a,u=1-a,c=u*u,l=c*u,d=l*t.startPoint.x,d+=3*c*a*t.control1.x,d+=3*u*h*t.control2.x,d+=r*t.endPoint.x,p=l*t.startPoint.y,p+=3*c*a*t.control1.y,p+=3*u*h*t.control2.y,p+=r*t.endPoint.y,o=e+r*y,this._drawPoint(d,p,o);v.closePath(),v.fill()},e.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};var n=function(t,e,n){this.x=t,this.y=e,this.time=n||(new Date).getTime()};n.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},n.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};var i=function(t,e,n,i){this.startPoint=t,this.control1=e,this.control2=n,this.endPoint=i};return i.prototype.length=function(){var t,e,n,i,o,s,a,h,r=10,u=0;for(t=0;r>=t;t++)e=t/r,n=this._point(e,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),i=this._point(e,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),t>0&&(a=n-o,h=i-s,u+=Math.sqrt(a*a+h*h)),o=n,s=i;return u},i.prototype._point=function(t,e,n,i,o){return e*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*i*(1-t)*t*t+o*t*t*t},e}(document);return t})}]);